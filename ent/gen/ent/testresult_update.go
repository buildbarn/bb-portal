// Code generated by ent, DO NOT EDIT.

package ent

import (
	"context"
	"errors"
	"fmt"
	"time"

	"entgo.io/ent/dialect/sql"
	"entgo.io/ent/dialect/sql/sqlgraph"
	"entgo.io/ent/dialect/sql/sqljson"
	"entgo.io/ent/schema/field"
	"github.com/buildbarn/bb-portal/ent/gen/ent/predicate"
	"github.com/buildbarn/bb-portal/ent/gen/ent/testresult"
	"github.com/buildbarn/bb-portal/ent/gen/ent/testsummary"
)

// TestResultUpdate is the builder for updating TestResult entities.
type TestResultUpdate struct {
	config
	hooks     []Hook
	mutation  *TestResultMutation
	modifiers []func(*sql.UpdateBuilder)
}

// Where appends a list predicates to the TestResultUpdate builder.
func (tru *TestResultUpdate) Where(ps ...predicate.TestResult) *TestResultUpdate {
	tru.mutation.Where(ps...)
	return tru
}

// SetStatus sets the "status" field.
func (tru *TestResultUpdate) SetStatus(s string) *TestResultUpdate {
	tru.mutation.SetStatus(s)
	return tru
}

// SetNillableStatus sets the "status" field if the given value is not nil.
func (tru *TestResultUpdate) SetNillableStatus(s *string) *TestResultUpdate {
	if s != nil {
		tru.SetStatus(*s)
	}
	return tru
}

// ClearStatus clears the value of the "status" field.
func (tru *TestResultUpdate) ClearStatus() *TestResultUpdate {
	tru.mutation.ClearStatus()
	return tru
}

// SetStatusDetails sets the "status_details" field.
func (tru *TestResultUpdate) SetStatusDetails(s string) *TestResultUpdate {
	tru.mutation.SetStatusDetails(s)
	return tru
}

// SetNillableStatusDetails sets the "status_details" field if the given value is not nil.
func (tru *TestResultUpdate) SetNillableStatusDetails(s *string) *TestResultUpdate {
	if s != nil {
		tru.SetStatusDetails(*s)
	}
	return tru
}

// ClearStatusDetails clears the value of the "status_details" field.
func (tru *TestResultUpdate) ClearStatusDetails() *TestResultUpdate {
	tru.mutation.ClearStatusDetails()
	return tru
}

// SetCachedLocally sets the "cached_locally" field.
func (tru *TestResultUpdate) SetCachedLocally(b bool) *TestResultUpdate {
	tru.mutation.SetCachedLocally(b)
	return tru
}

// SetNillableCachedLocally sets the "cached_locally" field if the given value is not nil.
func (tru *TestResultUpdate) SetNillableCachedLocally(b *bool) *TestResultUpdate {
	if b != nil {
		tru.SetCachedLocally(*b)
	}
	return tru
}

// ClearCachedLocally clears the value of the "cached_locally" field.
func (tru *TestResultUpdate) ClearCachedLocally() *TestResultUpdate {
	tru.mutation.ClearCachedLocally()
	return tru
}

// SetTestAttemptStart sets the "test_attempt_start" field.
func (tru *TestResultUpdate) SetTestAttemptStart(t time.Time) *TestResultUpdate {
	tru.mutation.SetTestAttemptStart(t)
	return tru
}

// SetNillableTestAttemptStart sets the "test_attempt_start" field if the given value is not nil.
func (tru *TestResultUpdate) SetNillableTestAttemptStart(t *time.Time) *TestResultUpdate {
	if t != nil {
		tru.SetTestAttemptStart(*t)
	}
	return tru
}

// ClearTestAttemptStart clears the value of the "test_attempt_start" field.
func (tru *TestResultUpdate) ClearTestAttemptStart() *TestResultUpdate {
	tru.mutation.ClearTestAttemptStart()
	return tru
}

// SetTestAttemptDurationInMs sets the "test_attempt_duration_in_ms" field.
func (tru *TestResultUpdate) SetTestAttemptDurationInMs(i int64) *TestResultUpdate {
	tru.mutation.ResetTestAttemptDurationInMs()
	tru.mutation.SetTestAttemptDurationInMs(i)
	return tru
}

// SetNillableTestAttemptDurationInMs sets the "test_attempt_duration_in_ms" field if the given value is not nil.
func (tru *TestResultUpdate) SetNillableTestAttemptDurationInMs(i *int64) *TestResultUpdate {
	if i != nil {
		tru.SetTestAttemptDurationInMs(*i)
	}
	return tru
}

// AddTestAttemptDurationInMs adds i to the "test_attempt_duration_in_ms" field.
func (tru *TestResultUpdate) AddTestAttemptDurationInMs(i int64) *TestResultUpdate {
	tru.mutation.AddTestAttemptDurationInMs(i)
	return tru
}

// ClearTestAttemptDurationInMs clears the value of the "test_attempt_duration_in_ms" field.
func (tru *TestResultUpdate) ClearTestAttemptDurationInMs() *TestResultUpdate {
	tru.mutation.ClearTestAttemptDurationInMs()
	return tru
}

// SetWarning sets the "warning" field.
func (tru *TestResultUpdate) SetWarning(s []string) *TestResultUpdate {
	tru.mutation.SetWarning(s)
	return tru
}

// AppendWarning appends s to the "warning" field.
func (tru *TestResultUpdate) AppendWarning(s []string) *TestResultUpdate {
	tru.mutation.AppendWarning(s)
	return tru
}

// ClearWarning clears the value of the "warning" field.
func (tru *TestResultUpdate) ClearWarning() *TestResultUpdate {
	tru.mutation.ClearWarning()
	return tru
}

// SetStrategy sets the "strategy" field.
func (tru *TestResultUpdate) SetStrategy(s string) *TestResultUpdate {
	tru.mutation.SetStrategy(s)
	return tru
}

// SetNillableStrategy sets the "strategy" field if the given value is not nil.
func (tru *TestResultUpdate) SetNillableStrategy(s *string) *TestResultUpdate {
	if s != nil {
		tru.SetStrategy(*s)
	}
	return tru
}

// ClearStrategy clears the value of the "strategy" field.
func (tru *TestResultUpdate) ClearStrategy() *TestResultUpdate {
	tru.mutation.ClearStrategy()
	return tru
}

// SetCachedRemotely sets the "cached_remotely" field.
func (tru *TestResultUpdate) SetCachedRemotely(b bool) *TestResultUpdate {
	tru.mutation.SetCachedRemotely(b)
	return tru
}

// SetNillableCachedRemotely sets the "cached_remotely" field if the given value is not nil.
func (tru *TestResultUpdate) SetNillableCachedRemotely(b *bool) *TestResultUpdate {
	if b != nil {
		tru.SetCachedRemotely(*b)
	}
	return tru
}

// ClearCachedRemotely clears the value of the "cached_remotely" field.
func (tru *TestResultUpdate) ClearCachedRemotely() *TestResultUpdate {
	tru.mutation.ClearCachedRemotely()
	return tru
}

// SetExitCode sets the "exit_code" field.
func (tru *TestResultUpdate) SetExitCode(i int32) *TestResultUpdate {
	tru.mutation.ResetExitCode()
	tru.mutation.SetExitCode(i)
	return tru
}

// SetNillableExitCode sets the "exit_code" field if the given value is not nil.
func (tru *TestResultUpdate) SetNillableExitCode(i *int32) *TestResultUpdate {
	if i != nil {
		tru.SetExitCode(*i)
	}
	return tru
}

// AddExitCode adds i to the "exit_code" field.
func (tru *TestResultUpdate) AddExitCode(i int32) *TestResultUpdate {
	tru.mutation.AddExitCode(i)
	return tru
}

// ClearExitCode clears the value of the "exit_code" field.
func (tru *TestResultUpdate) ClearExitCode() *TestResultUpdate {
	tru.mutation.ClearExitCode()
	return tru
}

// SetHostname sets the "hostname" field.
func (tru *TestResultUpdate) SetHostname(s string) *TestResultUpdate {
	tru.mutation.SetHostname(s)
	return tru
}

// SetNillableHostname sets the "hostname" field if the given value is not nil.
func (tru *TestResultUpdate) SetNillableHostname(s *string) *TestResultUpdate {
	if s != nil {
		tru.SetHostname(*s)
	}
	return tru
}

// ClearHostname clears the value of the "hostname" field.
func (tru *TestResultUpdate) ClearHostname() *TestResultUpdate {
	tru.mutation.ClearHostname()
	return tru
}

// SetTimingBreakdown sets the "timing_breakdown" field.
func (tru *TestResultUpdate) SetTimingBreakdown(m map[string]interface{}) *TestResultUpdate {
	tru.mutation.SetTimingBreakdown(m)
	return tru
}

// ClearTimingBreakdown clears the value of the "timing_breakdown" field.
func (tru *TestResultUpdate) ClearTimingBreakdown() *TestResultUpdate {
	tru.mutation.ClearTimingBreakdown()
	return tru
}

// SetTestSummaryID sets the "test_summary" edge to the TestSummary entity by ID.
func (tru *TestResultUpdate) SetTestSummaryID(id int64) *TestResultUpdate {
	tru.mutation.SetTestSummaryID(id)
	return tru
}

// SetTestSummary sets the "test_summary" edge to the TestSummary entity.
func (tru *TestResultUpdate) SetTestSummary(t *TestSummary) *TestResultUpdate {
	return tru.SetTestSummaryID(t.ID)
}

// Mutation returns the TestResultMutation object of the builder.
func (tru *TestResultUpdate) Mutation() *TestResultMutation {
	return tru.mutation
}

// ClearTestSummary clears the "test_summary" edge to the TestSummary entity.
func (tru *TestResultUpdate) ClearTestSummary() *TestResultUpdate {
	tru.mutation.ClearTestSummary()
	return tru
}

// Save executes the query and returns the number of nodes affected by the update operation.
func (tru *TestResultUpdate) Save(ctx context.Context) (int, error) {
	return withHooks(ctx, tru.sqlSave, tru.mutation, tru.hooks)
}

// SaveX is like Save, but panics if an error occurs.
func (tru *TestResultUpdate) SaveX(ctx context.Context) int {
	affected, err := tru.Save(ctx)
	if err != nil {
		panic(err)
	}
	return affected
}

// Exec executes the query.
func (tru *TestResultUpdate) Exec(ctx context.Context) error {
	_, err := tru.Save(ctx)
	return err
}

// ExecX is like Exec, but panics if an error occurs.
func (tru *TestResultUpdate) ExecX(ctx context.Context) {
	if err := tru.Exec(ctx); err != nil {
		panic(err)
	}
}

// check runs all checks and user-defined validators on the builder.
func (tru *TestResultUpdate) check() error {
	if tru.mutation.TestSummaryCleared() && len(tru.mutation.TestSummaryIDs()) > 0 {
		return errors.New(`ent: clearing a required unique edge "TestResult.test_summary"`)
	}
	return nil
}

// Modify adds a statement modifier for attaching custom logic to the UPDATE statement.
func (tru *TestResultUpdate) Modify(modifiers ...func(u *sql.UpdateBuilder)) *TestResultUpdate {
	tru.modifiers = append(tru.modifiers, modifiers...)
	return tru
}

func (tru *TestResultUpdate) sqlSave(ctx context.Context) (n int, err error) {
	if err := tru.check(); err != nil {
		return n, err
	}
	_spec := sqlgraph.NewUpdateSpec(testresult.Table, testresult.Columns, sqlgraph.NewFieldSpec(testresult.FieldID, field.TypeInt64))
	if ps := tru.mutation.predicates; len(ps) > 0 {
		_spec.Predicate = func(selector *sql.Selector) {
			for i := range ps {
				ps[i](selector)
			}
		}
	}
	if value, ok := tru.mutation.Status(); ok {
		_spec.SetField(testresult.FieldStatus, field.TypeString, value)
	}
	if tru.mutation.StatusCleared() {
		_spec.ClearField(testresult.FieldStatus, field.TypeString)
	}
	if value, ok := tru.mutation.StatusDetails(); ok {
		_spec.SetField(testresult.FieldStatusDetails, field.TypeString, value)
	}
	if tru.mutation.StatusDetailsCleared() {
		_spec.ClearField(testresult.FieldStatusDetails, field.TypeString)
	}
	if value, ok := tru.mutation.CachedLocally(); ok {
		_spec.SetField(testresult.FieldCachedLocally, field.TypeBool, value)
	}
	if tru.mutation.CachedLocallyCleared() {
		_spec.ClearField(testresult.FieldCachedLocally, field.TypeBool)
	}
	if value, ok := tru.mutation.TestAttemptStart(); ok {
		_spec.SetField(testresult.FieldTestAttemptStart, field.TypeTime, value)
	}
	if tru.mutation.TestAttemptStartCleared() {
		_spec.ClearField(testresult.FieldTestAttemptStart, field.TypeTime)
	}
	if value, ok := tru.mutation.TestAttemptDurationInMs(); ok {
		_spec.SetField(testresult.FieldTestAttemptDurationInMs, field.TypeInt64, value)
	}
	if value, ok := tru.mutation.AddedTestAttemptDurationInMs(); ok {
		_spec.AddField(testresult.FieldTestAttemptDurationInMs, field.TypeInt64, value)
	}
	if tru.mutation.TestAttemptDurationInMsCleared() {
		_spec.ClearField(testresult.FieldTestAttemptDurationInMs, field.TypeInt64)
	}
	if value, ok := tru.mutation.Warning(); ok {
		_spec.SetField(testresult.FieldWarning, field.TypeJSON, value)
	}
	if value, ok := tru.mutation.AppendedWarning(); ok {
		_spec.AddModifier(func(u *sql.UpdateBuilder) {
			sqljson.Append(u, testresult.FieldWarning, value)
		})
	}
	if tru.mutation.WarningCleared() {
		_spec.ClearField(testresult.FieldWarning, field.TypeJSON)
	}
	if value, ok := tru.mutation.Strategy(); ok {
		_spec.SetField(testresult.FieldStrategy, field.TypeString, value)
	}
	if tru.mutation.StrategyCleared() {
		_spec.ClearField(testresult.FieldStrategy, field.TypeString)
	}
	if value, ok := tru.mutation.CachedRemotely(); ok {
		_spec.SetField(testresult.FieldCachedRemotely, field.TypeBool, value)
	}
	if tru.mutation.CachedRemotelyCleared() {
		_spec.ClearField(testresult.FieldCachedRemotely, field.TypeBool)
	}
	if value, ok := tru.mutation.ExitCode(); ok {
		_spec.SetField(testresult.FieldExitCode, field.TypeInt32, value)
	}
	if value, ok := tru.mutation.AddedExitCode(); ok {
		_spec.AddField(testresult.FieldExitCode, field.TypeInt32, value)
	}
	if tru.mutation.ExitCodeCleared() {
		_spec.ClearField(testresult.FieldExitCode, field.TypeInt32)
	}
	if value, ok := tru.mutation.Hostname(); ok {
		_spec.SetField(testresult.FieldHostname, field.TypeString, value)
	}
	if tru.mutation.HostnameCleared() {
		_spec.ClearField(testresult.FieldHostname, field.TypeString)
	}
	if value, ok := tru.mutation.TimingBreakdown(); ok {
		_spec.SetField(testresult.FieldTimingBreakdown, field.TypeJSON, value)
	}
	if tru.mutation.TimingBreakdownCleared() {
		_spec.ClearField(testresult.FieldTimingBreakdown, field.TypeJSON)
	}
	if tru.mutation.TestSummaryCleared() {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.M2O,
			Inverse: true,
			Table:   testresult.TestSummaryTable,
			Columns: []string{testresult.TestSummaryColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(testsummary.FieldID, field.TypeInt64),
			},
		}
		_spec.Edges.Clear = append(_spec.Edges.Clear, edge)
	}
	if nodes := tru.mutation.TestSummaryIDs(); len(nodes) > 0 {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.M2O,
			Inverse: true,
			Table:   testresult.TestSummaryTable,
			Columns: []string{testresult.TestSummaryColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(testsummary.FieldID, field.TypeInt64),
			},
		}
		for _, k := range nodes {
			edge.Target.Nodes = append(edge.Target.Nodes, k)
		}
		_spec.Edges.Add = append(_spec.Edges.Add, edge)
	}
	_spec.AddModifiers(tru.modifiers...)
	if n, err = sqlgraph.UpdateNodes(ctx, tru.driver, _spec); err != nil {
		if _, ok := err.(*sqlgraph.NotFoundError); ok {
			err = &NotFoundError{testresult.Label}
		} else if sqlgraph.IsConstraintError(err) {
			err = &ConstraintError{msg: err.Error(), wrap: err}
		}
		return 0, err
	}
	tru.mutation.done = true
	return n, nil
}

// TestResultUpdateOne is the builder for updating a single TestResult entity.
type TestResultUpdateOne struct {
	config
	fields    []string
	hooks     []Hook
	mutation  *TestResultMutation
	modifiers []func(*sql.UpdateBuilder)
}

// SetStatus sets the "status" field.
func (truo *TestResultUpdateOne) SetStatus(s string) *TestResultUpdateOne {
	truo.mutation.SetStatus(s)
	return truo
}

// SetNillableStatus sets the "status" field if the given value is not nil.
func (truo *TestResultUpdateOne) SetNillableStatus(s *string) *TestResultUpdateOne {
	if s != nil {
		truo.SetStatus(*s)
	}
	return truo
}

// ClearStatus clears the value of the "status" field.
func (truo *TestResultUpdateOne) ClearStatus() *TestResultUpdateOne {
	truo.mutation.ClearStatus()
	return truo
}

// SetStatusDetails sets the "status_details" field.
func (truo *TestResultUpdateOne) SetStatusDetails(s string) *TestResultUpdateOne {
	truo.mutation.SetStatusDetails(s)
	return truo
}

// SetNillableStatusDetails sets the "status_details" field if the given value is not nil.
func (truo *TestResultUpdateOne) SetNillableStatusDetails(s *string) *TestResultUpdateOne {
	if s != nil {
		truo.SetStatusDetails(*s)
	}
	return truo
}

// ClearStatusDetails clears the value of the "status_details" field.
func (truo *TestResultUpdateOne) ClearStatusDetails() *TestResultUpdateOne {
	truo.mutation.ClearStatusDetails()
	return truo
}

// SetCachedLocally sets the "cached_locally" field.
func (truo *TestResultUpdateOne) SetCachedLocally(b bool) *TestResultUpdateOne {
	truo.mutation.SetCachedLocally(b)
	return truo
}

// SetNillableCachedLocally sets the "cached_locally" field if the given value is not nil.
func (truo *TestResultUpdateOne) SetNillableCachedLocally(b *bool) *TestResultUpdateOne {
	if b != nil {
		truo.SetCachedLocally(*b)
	}
	return truo
}

// ClearCachedLocally clears the value of the "cached_locally" field.
func (truo *TestResultUpdateOne) ClearCachedLocally() *TestResultUpdateOne {
	truo.mutation.ClearCachedLocally()
	return truo
}

// SetTestAttemptStart sets the "test_attempt_start" field.
func (truo *TestResultUpdateOne) SetTestAttemptStart(t time.Time) *TestResultUpdateOne {
	truo.mutation.SetTestAttemptStart(t)
	return truo
}

// SetNillableTestAttemptStart sets the "test_attempt_start" field if the given value is not nil.
func (truo *TestResultUpdateOne) SetNillableTestAttemptStart(t *time.Time) *TestResultUpdateOne {
	if t != nil {
		truo.SetTestAttemptStart(*t)
	}
	return truo
}

// ClearTestAttemptStart clears the value of the "test_attempt_start" field.
func (truo *TestResultUpdateOne) ClearTestAttemptStart() *TestResultUpdateOne {
	truo.mutation.ClearTestAttemptStart()
	return truo
}

// SetTestAttemptDurationInMs sets the "test_attempt_duration_in_ms" field.
func (truo *TestResultUpdateOne) SetTestAttemptDurationInMs(i int64) *TestResultUpdateOne {
	truo.mutation.ResetTestAttemptDurationInMs()
	truo.mutation.SetTestAttemptDurationInMs(i)
	return truo
}

// SetNillableTestAttemptDurationInMs sets the "test_attempt_duration_in_ms" field if the given value is not nil.
func (truo *TestResultUpdateOne) SetNillableTestAttemptDurationInMs(i *int64) *TestResultUpdateOne {
	if i != nil {
		truo.SetTestAttemptDurationInMs(*i)
	}
	return truo
}

// AddTestAttemptDurationInMs adds i to the "test_attempt_duration_in_ms" field.
func (truo *TestResultUpdateOne) AddTestAttemptDurationInMs(i int64) *TestResultUpdateOne {
	truo.mutation.AddTestAttemptDurationInMs(i)
	return truo
}

// ClearTestAttemptDurationInMs clears the value of the "test_attempt_duration_in_ms" field.
func (truo *TestResultUpdateOne) ClearTestAttemptDurationInMs() *TestResultUpdateOne {
	truo.mutation.ClearTestAttemptDurationInMs()
	return truo
}

// SetWarning sets the "warning" field.
func (truo *TestResultUpdateOne) SetWarning(s []string) *TestResultUpdateOne {
	truo.mutation.SetWarning(s)
	return truo
}

// AppendWarning appends s to the "warning" field.
func (truo *TestResultUpdateOne) AppendWarning(s []string) *TestResultUpdateOne {
	truo.mutation.AppendWarning(s)
	return truo
}

// ClearWarning clears the value of the "warning" field.
func (truo *TestResultUpdateOne) ClearWarning() *TestResultUpdateOne {
	truo.mutation.ClearWarning()
	return truo
}

// SetStrategy sets the "strategy" field.
func (truo *TestResultUpdateOne) SetStrategy(s string) *TestResultUpdateOne {
	truo.mutation.SetStrategy(s)
	return truo
}

// SetNillableStrategy sets the "strategy" field if the given value is not nil.
func (truo *TestResultUpdateOne) SetNillableStrategy(s *string) *TestResultUpdateOne {
	if s != nil {
		truo.SetStrategy(*s)
	}
	return truo
}

// ClearStrategy clears the value of the "strategy" field.
func (truo *TestResultUpdateOne) ClearStrategy() *TestResultUpdateOne {
	truo.mutation.ClearStrategy()
	return truo
}

// SetCachedRemotely sets the "cached_remotely" field.
func (truo *TestResultUpdateOne) SetCachedRemotely(b bool) *TestResultUpdateOne {
	truo.mutation.SetCachedRemotely(b)
	return truo
}

// SetNillableCachedRemotely sets the "cached_remotely" field if the given value is not nil.
func (truo *TestResultUpdateOne) SetNillableCachedRemotely(b *bool) *TestResultUpdateOne {
	if b != nil {
		truo.SetCachedRemotely(*b)
	}
	return truo
}

// ClearCachedRemotely clears the value of the "cached_remotely" field.
func (truo *TestResultUpdateOne) ClearCachedRemotely() *TestResultUpdateOne {
	truo.mutation.ClearCachedRemotely()
	return truo
}

// SetExitCode sets the "exit_code" field.
func (truo *TestResultUpdateOne) SetExitCode(i int32) *TestResultUpdateOne {
	truo.mutation.ResetExitCode()
	truo.mutation.SetExitCode(i)
	return truo
}

// SetNillableExitCode sets the "exit_code" field if the given value is not nil.
func (truo *TestResultUpdateOne) SetNillableExitCode(i *int32) *TestResultUpdateOne {
	if i != nil {
		truo.SetExitCode(*i)
	}
	return truo
}

// AddExitCode adds i to the "exit_code" field.
func (truo *TestResultUpdateOne) AddExitCode(i int32) *TestResultUpdateOne {
	truo.mutation.AddExitCode(i)
	return truo
}

// ClearExitCode clears the value of the "exit_code" field.
func (truo *TestResultUpdateOne) ClearExitCode() *TestResultUpdateOne {
	truo.mutation.ClearExitCode()
	return truo
}

// SetHostname sets the "hostname" field.
func (truo *TestResultUpdateOne) SetHostname(s string) *TestResultUpdateOne {
	truo.mutation.SetHostname(s)
	return truo
}

// SetNillableHostname sets the "hostname" field if the given value is not nil.
func (truo *TestResultUpdateOne) SetNillableHostname(s *string) *TestResultUpdateOne {
	if s != nil {
		truo.SetHostname(*s)
	}
	return truo
}

// ClearHostname clears the value of the "hostname" field.
func (truo *TestResultUpdateOne) ClearHostname() *TestResultUpdateOne {
	truo.mutation.ClearHostname()
	return truo
}

// SetTimingBreakdown sets the "timing_breakdown" field.
func (truo *TestResultUpdateOne) SetTimingBreakdown(m map[string]interface{}) *TestResultUpdateOne {
	truo.mutation.SetTimingBreakdown(m)
	return truo
}

// ClearTimingBreakdown clears the value of the "timing_breakdown" field.
func (truo *TestResultUpdateOne) ClearTimingBreakdown() *TestResultUpdateOne {
	truo.mutation.ClearTimingBreakdown()
	return truo
}

// SetTestSummaryID sets the "test_summary" edge to the TestSummary entity by ID.
func (truo *TestResultUpdateOne) SetTestSummaryID(id int64) *TestResultUpdateOne {
	truo.mutation.SetTestSummaryID(id)
	return truo
}

// SetTestSummary sets the "test_summary" edge to the TestSummary entity.
func (truo *TestResultUpdateOne) SetTestSummary(t *TestSummary) *TestResultUpdateOne {
	return truo.SetTestSummaryID(t.ID)
}

// Mutation returns the TestResultMutation object of the builder.
func (truo *TestResultUpdateOne) Mutation() *TestResultMutation {
	return truo.mutation
}

// ClearTestSummary clears the "test_summary" edge to the TestSummary entity.
func (truo *TestResultUpdateOne) ClearTestSummary() *TestResultUpdateOne {
	truo.mutation.ClearTestSummary()
	return truo
}

// Where appends a list predicates to the TestResultUpdate builder.
func (truo *TestResultUpdateOne) Where(ps ...predicate.TestResult) *TestResultUpdateOne {
	truo.mutation.Where(ps...)
	return truo
}

// Select allows selecting one or more fields (columns) of the returned entity.
// The default is selecting all fields defined in the entity schema.
func (truo *TestResultUpdateOne) Select(field string, fields ...string) *TestResultUpdateOne {
	truo.fields = append([]string{field}, fields...)
	return truo
}

// Save executes the query and returns the updated TestResult entity.
func (truo *TestResultUpdateOne) Save(ctx context.Context) (*TestResult, error) {
	return withHooks(ctx, truo.sqlSave, truo.mutation, truo.hooks)
}

// SaveX is like Save, but panics if an error occurs.
func (truo *TestResultUpdateOne) SaveX(ctx context.Context) *TestResult {
	node, err := truo.Save(ctx)
	if err != nil {
		panic(err)
	}
	return node
}

// Exec executes the query on the entity.
func (truo *TestResultUpdateOne) Exec(ctx context.Context) error {
	_, err := truo.Save(ctx)
	return err
}

// ExecX is like Exec, but panics if an error occurs.
func (truo *TestResultUpdateOne) ExecX(ctx context.Context) {
	if err := truo.Exec(ctx); err != nil {
		panic(err)
	}
}

// check runs all checks and user-defined validators on the builder.
func (truo *TestResultUpdateOne) check() error {
	if truo.mutation.TestSummaryCleared() && len(truo.mutation.TestSummaryIDs()) > 0 {
		return errors.New(`ent: clearing a required unique edge "TestResult.test_summary"`)
	}
	return nil
}

// Modify adds a statement modifier for attaching custom logic to the UPDATE statement.
func (truo *TestResultUpdateOne) Modify(modifiers ...func(u *sql.UpdateBuilder)) *TestResultUpdateOne {
	truo.modifiers = append(truo.modifiers, modifiers...)
	return truo
}

func (truo *TestResultUpdateOne) sqlSave(ctx context.Context) (_node *TestResult, err error) {
	if err := truo.check(); err != nil {
		return _node, err
	}
	_spec := sqlgraph.NewUpdateSpec(testresult.Table, testresult.Columns, sqlgraph.NewFieldSpec(testresult.FieldID, field.TypeInt64))
	id, ok := truo.mutation.ID()
	if !ok {
		return nil, &ValidationError{Name: "id", err: errors.New(`ent: missing "TestResult.id" for update`)}
	}
	_spec.Node.ID.Value = id
	if fields := truo.fields; len(fields) > 0 {
		_spec.Node.Columns = make([]string, 0, len(fields))
		_spec.Node.Columns = append(_spec.Node.Columns, testresult.FieldID)
		for _, f := range fields {
			if !testresult.ValidColumn(f) {
				return nil, &ValidationError{Name: f, err: fmt.Errorf("ent: invalid field %q for query", f)}
			}
			if f != testresult.FieldID {
				_spec.Node.Columns = append(_spec.Node.Columns, f)
			}
		}
	}
	if ps := truo.mutation.predicates; len(ps) > 0 {
		_spec.Predicate = func(selector *sql.Selector) {
			for i := range ps {
				ps[i](selector)
			}
		}
	}
	if value, ok := truo.mutation.Status(); ok {
		_spec.SetField(testresult.FieldStatus, field.TypeString, value)
	}
	if truo.mutation.StatusCleared() {
		_spec.ClearField(testresult.FieldStatus, field.TypeString)
	}
	if value, ok := truo.mutation.StatusDetails(); ok {
		_spec.SetField(testresult.FieldStatusDetails, field.TypeString, value)
	}
	if truo.mutation.StatusDetailsCleared() {
		_spec.ClearField(testresult.FieldStatusDetails, field.TypeString)
	}
	if value, ok := truo.mutation.CachedLocally(); ok {
		_spec.SetField(testresult.FieldCachedLocally, field.TypeBool, value)
	}
	if truo.mutation.CachedLocallyCleared() {
		_spec.ClearField(testresult.FieldCachedLocally, field.TypeBool)
	}
	if value, ok := truo.mutation.TestAttemptStart(); ok {
		_spec.SetField(testresult.FieldTestAttemptStart, field.TypeTime, value)
	}
	if truo.mutation.TestAttemptStartCleared() {
		_spec.ClearField(testresult.FieldTestAttemptStart, field.TypeTime)
	}
	if value, ok := truo.mutation.TestAttemptDurationInMs(); ok {
		_spec.SetField(testresult.FieldTestAttemptDurationInMs, field.TypeInt64, value)
	}
	if value, ok := truo.mutation.AddedTestAttemptDurationInMs(); ok {
		_spec.AddField(testresult.FieldTestAttemptDurationInMs, field.TypeInt64, value)
	}
	if truo.mutation.TestAttemptDurationInMsCleared() {
		_spec.ClearField(testresult.FieldTestAttemptDurationInMs, field.TypeInt64)
	}
	if value, ok := truo.mutation.Warning(); ok {
		_spec.SetField(testresult.FieldWarning, field.TypeJSON, value)
	}
	if value, ok := truo.mutation.AppendedWarning(); ok {
		_spec.AddModifier(func(u *sql.UpdateBuilder) {
			sqljson.Append(u, testresult.FieldWarning, value)
		})
	}
	if truo.mutation.WarningCleared() {
		_spec.ClearField(testresult.FieldWarning, field.TypeJSON)
	}
	if value, ok := truo.mutation.Strategy(); ok {
		_spec.SetField(testresult.FieldStrategy, field.TypeString, value)
	}
	if truo.mutation.StrategyCleared() {
		_spec.ClearField(testresult.FieldStrategy, field.TypeString)
	}
	if value, ok := truo.mutation.CachedRemotely(); ok {
		_spec.SetField(testresult.FieldCachedRemotely, field.TypeBool, value)
	}
	if truo.mutation.CachedRemotelyCleared() {
		_spec.ClearField(testresult.FieldCachedRemotely, field.TypeBool)
	}
	if value, ok := truo.mutation.ExitCode(); ok {
		_spec.SetField(testresult.FieldExitCode, field.TypeInt32, value)
	}
	if value, ok := truo.mutation.AddedExitCode(); ok {
		_spec.AddField(testresult.FieldExitCode, field.TypeInt32, value)
	}
	if truo.mutation.ExitCodeCleared() {
		_spec.ClearField(testresult.FieldExitCode, field.TypeInt32)
	}
	if value, ok := truo.mutation.Hostname(); ok {
		_spec.SetField(testresult.FieldHostname, field.TypeString, value)
	}
	if truo.mutation.HostnameCleared() {
		_spec.ClearField(testresult.FieldHostname, field.TypeString)
	}
	if value, ok := truo.mutation.TimingBreakdown(); ok {
		_spec.SetField(testresult.FieldTimingBreakdown, field.TypeJSON, value)
	}
	if truo.mutation.TimingBreakdownCleared() {
		_spec.ClearField(testresult.FieldTimingBreakdown, field.TypeJSON)
	}
	if truo.mutation.TestSummaryCleared() {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.M2O,
			Inverse: true,
			Table:   testresult.TestSummaryTable,
			Columns: []string{testresult.TestSummaryColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(testsummary.FieldID, field.TypeInt64),
			},
		}
		_spec.Edges.Clear = append(_spec.Edges.Clear, edge)
	}
	if nodes := truo.mutation.TestSummaryIDs(); len(nodes) > 0 {
		edge := &sqlgraph.EdgeSpec{
			Rel:     sqlgraph.M2O,
			Inverse: true,
			Table:   testresult.TestSummaryTable,
			Columns: []string{testresult.TestSummaryColumn},
			Bidi:    false,
			Target: &sqlgraph.EdgeTarget{
				IDSpec: sqlgraph.NewFieldSpec(testsummary.FieldID, field.TypeInt64),
			},
		}
		for _, k := range nodes {
			edge.Target.Nodes = append(edge.Target.Nodes, k)
		}
		_spec.Edges.Add = append(_spec.Edges.Add, edge)
	}
	_spec.AddModifiers(truo.modifiers...)
	_node = &TestResult{config: truo.config}
	_spec.Assign = _node.assignValues
	_spec.ScanValues = _node.scanValues
	if err = sqlgraph.UpdateNode(ctx, truo.driver, _spec); err != nil {
		if _, ok := err.(*sqlgraph.NotFoundError); ok {
			err = &NotFoundError{testresult.Label}
		} else if sqlgraph.IsConstraintError(err) {
			err = &ConstraintError{msg: err.Error(), wrap: err}
		}
		return nil, err
	}
	truo.mutation.done = true
	return _node, nil
}
